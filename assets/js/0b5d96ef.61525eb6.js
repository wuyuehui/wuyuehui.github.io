"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[348],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(7294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=r.createContext({}),c=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=c(t),d=s,k=m["".concat(i,".").concat(d)]||m[d]||u[d]||a;return t?r.createElement(k,l(l({ref:n},p),{},{components:t})):r.createElement(k,l({ref:n},p))}));function d(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,l=new Array(a);l[0]=m;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o.mdxType="string"==typeof e?e:s,l[1]=o;for(var c=2;c<a;c++)l[c]=t[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1617:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var r=t(7462),s=t(3366),a=(t(7294),t(3905)),l=["components"],o={id:"promise\u5b9e\u73b0",sidebar_label:"Promise\u5b9e\u73b0",title:"Promise",slug:"/front-end/javaSciprt/promise/promise\u5b9e\u73b0"},i=void 0,c={unversionedId:"front-end/javaScript/promise/promise\u5b9e\u73b0",id:"front-end/javaScript/promise/promise\u5b9e\u73b0",title:"Promise",description:"\u5b9e\u73b0Promis\u4e4b\u524d",source:"@site/docs/front-end/javaScript/promise/promise\u5b9e\u73b0.md",sourceDirName:"front-end/javaScript/promise",slug:"/front-end/javaSciprt/promise/promise\u5b9e\u73b0",permalink:"/front-end/javaSciprt/promise/promise\u5b9e\u73b0",editUrl:"https://github.com/wuyuehui/wuyuehui.github.io/edit/main/docs/front-end/javaScript/promise/promise\u5b9e\u73b0.md",tags:[],version:"current",frontMatter:{id:"promise\u5b9e\u73b0",sidebar_label:"Promise\u5b9e\u73b0",title:"Promise",slug:"/front-end/javaSciprt/promise/promise\u5b9e\u73b0"},sidebar:"docs",previous:{title:"Promise\u4f7f\u7528",permalink:"/front-end/javaSciprt/promise/promise\u4f7f\u7528"}},p=[{value:"\u5b9e\u73b0Promis\u4e4b\u524d",id:"\u5b9e\u73b0promis\u4e4b\u524d",children:[],level:2},{value:"\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2aPromise",id:"\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2apromise",children:[],level:2}],u={toc:p};function m(e){var n=e.components,t=(0,s.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u5b9e\u73b0promis\u4e4b\u524d"},"\u5b9e\u73b0Promis\u4e4b\u524d"),(0,a.kt)("p",null,"\u4e3a\u4e86\u66f4\u597d\u7684\u4e86\u89e3Promise,\u51c6\u5907\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5df1\u7684Promise"),(0,a.kt)("p",null,"\u4f46\u662f\u5728\u5b9e\u73b0Promise\u4e4b\u524d\uff0c\u9700\u8981\u4e86\u89e3\u4e00\u4e0b",(0,a.kt)("a",{parentName:"p",href:"https://promisesaplus.com/"},"Promise/A+"),"(",(0,a.kt)("a",{parentName:"p",href:"https://promisesaplus.cn/"},"\u4e2d\u6587"),")\u89c4\u8303\u3002"),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u5f00\u59cb\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2a\u7b26\u5408Promise/A+\u89c4\u8303\u7684Promise"),(0,a.kt)("h2",{id:"\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2apromise"},"\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2aPromise"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5e73\u5e38\u7528promise\u7684\u65f6\u5019, \u662f\u901a\u8fc7new\u5173\u952e\u5b57\u6765new Promise()")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class MPromise {\n    constructor() {\n\n    }\n}\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"\u5b9a\u4e49\u4e09\u79cd\u72b6\u6001\u7c7b\u578b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e\u521d\u59cb\u72b6\u6001")),(0,a.kt)("p",null,"\u540c\u65f6\u4e3a\u4e86\u53d6\u503c\u548c\u4f7f\u7528\u65b9\u4fbf\uff0c\u628avalue\u548creason\u4e5f\u6302\u8f7d\u5728\u5b9e\u4f8b\u4e0a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class MPromise {\n    constructor() {\n        // \u521d\u59cb\u72b6\u6001\u4e3apending\n        this.status = PENDING;\n        this.value = null;\n        this.reason = null;\n    }\n}\n")),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"resolve \u548c reject \u65b9\u6cd5"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u6839\u636e\u521a\u8303, \u8fd9\u4e24\u4e2a\u65b9\u6cd5\u662f\u8981\u66f4\u6539status\u7684, \u4ecepending\u6539\u5230fulfilled/rejected."),(0,a.kt)("li",{parentName:"ol"},"\u6ce8\u610f\u4e24\u4e2a\u51fd\u6570\u7684\u5165\u53c2\u5206\u522b\u662fvalue \u548c reason. ")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class MPromise {\n    constructor() {\n        // \u521d\u59cb\u72b6\u6001\u4e3apending\n        this.status = PENDING;\n        this.value = null;\n        this.reason = null;\n    }\n\n    resolve(value) {\n        if (this.status === PENDING) {\n            this.value = value;\n            this.status = FULFILLED;\n        }\n    }\n\n    reject(reason) {\n        if (this.status === PENDING) {\n            this.reason = reason;\n            this.status = REJECTED;\n        }\n    }\n}\n")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Promise\u7684\u5165\u53c2"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u5165\u53c2\u662f\u4e00\u4e2a\u51fd\u6570, \u51fd\u6570\u63a5\u6536resolve\u548creject\u4e24\u4e2a\u53c2\u6570."),(0,a.kt)("li",{parentName:"ol"},"\u6ce8\u610f\u5728",(0,a.kt)("inlineCode",{parentName:"li"},"\u521d\u59cb\u5316"),"promise\u7684\u65f6\u5019, \u5c31\u8981",(0,a.kt)("inlineCode",{parentName:"li"},"\u6267\u884c"),"\u8fd9\u4e2a\u51fd\u6570, \u5e76\u4e14\u6709\u4efb\u4f55\u62a5\u9519\u90fd\u8981\u901a\u8fc7reject\u629b\u51fa\u53bb")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class MPromise {\n    constructor(executor) {\n        // \u521d\u59cb\u72b6\u6001\u4e3apending\n        this.status = PENDING;\n        this.value = null;\n        this.reason = null;\n\n        try {\n            // \u4f7f\u7528bind\u7ed1\u5b9athis\uff0c\u8fd9\u6837\u8c03\u7528\u7684\u65f6\u5019\n            executor(this.resolve.bind(this), this.reject.bind(this));\n        } catch (e) {\n            this.reject(e);\n        }\n    }\n\n    resolve(value) {\n        if (this.status === PENDING) {\n            this.value = value;\n            this.status = FULFILLED;\n        }\n    }\n\n    reject(reason) {\n        if (this.status === PENDING) {\n            this.reason = reason;\n            this.status = REJECTED;\n        }\n    }\n}\n")),(0,a.kt)("ol",{start:6},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5173\u952e\u7684then\u65b9\u6cd5"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"then\u63a5\u6536\u4e24\u4e2a\u53c2\u6570, onFulfilled \u548c onRejected")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"then(onFulfilled, onRejected) {}\n")),(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"\u68c0\u67e5\u5e76\u5904\u7406\u53c2\u6570, \u5982\u679c\u4e0d\u662ffunction, \u5c31\u5ffd\u7565. \u8fd9\u4e2a\u5ffd\u7565\u6307\u7684\u662f\u539f\u6837\u8fd4\u56devalue\u6216\u8005reason.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u5b9a\u4e49\u4e00\u4e2aisFunction\u65b9\u6cd5\u7528\u6765\u68c0\u67e5\nisFunction(param) {\n    return typeof param === 'function';\n}\n\nthen(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n}\n")),(0,a.kt)("ol",{parentName:"li",start:3},(0,a.kt)("li",{parentName:"ol"},"\u8c03\u7528.then\u540e\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2apromise, \u6240\u4ee5\u7528promise\u6765\u5305\u88f9\u4e00\u4e0b, \u5176\u4ed6\u903b\u8f91\u5f85\u4f1a\u518d\u5b9e\u73b0.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"then(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n    const promise2 = new MPromise((resolve, reject) => {})\n    return promise2\n}\n\n")),(0,a.kt)("ol",{parentName:"li",start:4},(0,a.kt)("li",{parentName:"ol"},"\u6839\u636e\u5f53\u524dpromise\u7684\u72b6\u6001, \u8c03\u7528\u4e0d\u540c\u7684\u51fd\u6570")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"then(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n    const promise2 = new MPromise((resolve, reject) => {\n        switch (this.status) {\n            case FULFILLED: {\n                realOnFulfilled()\n                break;\n            }\n            case REJECTED: {\n                realOnRejected()\n                break;\n            }\n        }\n    })\n    return promise2\n\n}\n")),(0,a.kt)("ol",{parentName:"li",start:5},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4f46\u662f\u8fd9\u6837\u5199, \u662f\u5728then\u51fd\u6570\u88ab\u8c03\u7528\u7684\u77ac\u95f4\u5c31\u4f1a\u6267\u884c. \u8fd9\u65f6\u5019\u5982\u679cstatus\u8fd8\u6ca1\u53d8\u6210fulfilled\u6216\u8005rejected(\u6bd4\u5982\u8bbe\u7f6e\u4e86setTimeout), \u5f88\u6709\u53ef\u80fd\u8fd8\u662fpending\u7684. \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u72b6\u6001\u7684\u76d1\u542c\u673a\u5236, \u5f53\u72b6\u6001\u53d8\u6210fulfilled\u6216\u8005rejected\u540e, \u518d\u53bb\u6267\u884ccallback."),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u90a3\u4e48\u6211\u4eec\u9996\u5148\u8981\u62ff\u5230\u6240\u6709\u7684callback, \u7136\u540e\u624d\u80fd\u5728\u67d0\u4e2a\u65f6\u673a\u53bb\u6267\u884c\u4ed6. \u65b0\u5efa\u4e24\u4e2a\u6570\u7ec4, \u6765\u5206\u522b\u5b58\u50a8\u6210\u529f\u548c\u5931\u8d25\u7684\u56de\u8c03, \u8c03\u7528then\u7684\u65f6\u5019, \u5982\u679c\u8fd8\u662fpending\u5c31\u5b58\u5165\u6570\u7ec4.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FULFILLED_CALLBACK_LIST = [];\nREJECTED_CALLBACK_LIST = [];\n\nthen(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n    const promise2 = new MPromise((resolve, reject) => {\n        switch (this.status) {\n            case FULFILLED: {\n                realOnFulfilled()\n                break;\n            }\n            case REJECTED: {\n                realOnRejected()\n                break;\n            }\n            case PENDING: {\n                this.FULFILLED_CALLBACK_LIST.push(realOnFulfilled)\n                this.REJECTED_CALLBACK_LIST.push(realOnRejected)\n            }\n        }\n    })\n    return promise2\n}\n")),(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"\u5728status\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019, \u5c31\u6267\u884c\u6240\u6709\u7684\u56de\u8c03. \u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528es6\u7684getter\u548csetter. \u8fd9\u6837\u66f4\u7b26\u5408\u8bed\u4e49, \u5f53status\u6539\u53d8\u65f6, \u53bb\u505a\u4ec0\u4e48\u4e8b\u60c5.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"_status = PENDING;\n\nget status() {\n    return this._status;\n}\n\nset status(newStatus) {\n    this._status = newStatus;\n    switch (newStatus) {\n        case FULFILLED: {\n            this.FULFILLED_CALLBACK_LIST.forEach(callback => {\n                callback(this.value);\n            });\n            break;\n        }\n        case REJECTED: {\n            this.REJECTED_CALLBACK_LIST.forEach(callback => {\n                callback(this.reason);\n            });\n            break;\n        }\n    }\n}\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"then\u7684\u8fd4\u56de\u503c\n\u6211\u4eec\u77e5\u9053then\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2aPromise, \u90a3\u4e48\u63a5\u4e0b\u6765\u5177\u4f53\u5206\u6790\u4e00\u4e0b\u8fd4\u56depromise\u7684value\u548creason\u662f\u4ec0\u4e48."),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c onFulfilled \u6216\u8005 onRejected \u629b\u51fa\u4e00\u4e2a\u5f02\u5e38 e \uff0c\u5219 promise2 \u5fc5\u987b\u62d2\u7edd\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u62d2\u7edd\u539f\u56e0 e\u3002(\u8fd9\u6837\u7684\u8bdd, \u6211\u4eec\u5c31\u9700\u8981\u624b\u52a8catch\u4ee3\u7801\uff0c\u9047\u5230\u62a5\u9519\u5c31reject)"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"then(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n    const promise2 = new MPromise((resolve, reject) => {\n        const fulfilledMicrotask = () => {\n            try {\n                realOnFulfilled(this.value);\n            } catch (e) {\n                reject(e)\n            }\n        };\n        const rejectedMicrotask = () => {\n            try {\n                realOnRejected(this.reason);\n            } catch (e) {\n                reject(e);\n            }\n        }\n\n        switch (this.status) {\n            case FULFILLED: {\n                fulfilledMicrotask()\n                break;\n            }\n            case REJECTED: {\n                rejectedMicrotask()\n                break;\n            }\n            case PENDING: {\n                this.FULFILLED_CALLBACK_LIST.push(fulfilledMicrotask)\n                this.REJECTED_CALLBACK_LIST.push(rejectedMicrotask)\n            }\n        }\n    })\n    return promise2\n}\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c onFulfilled \u4e0d\u662f\u51fd\u6570\u4e14 promise1 \u6210\u529f\u6267\u884c\uff0c promise2 \u5fc5\u987b\u6210\u529f\u6267\u884c\u5e76\u8fd4\u56de\u76f8\u540c\u7684\u503c")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c onRejected \u4e0d\u662f\u51fd\u6570\u4e14 promise1 \u62d2\u7edd\u6267\u884c\uff0c promise2 \u5fc5\u987b\u62d2\u7edd\u6267\u884c\u5e76\u8fd4\u56de\u76f8\u540c\u7684\u62d2\u7edd\u539f\u56e0"),(0,a.kt)("p",{parentName:"li"},"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679cpromise1\u7684onRejected\u6267\u884c\u6210\u529f\u4e86\uff0cpromise2\u5e94\u8be5\u88abresolve"),(0,a.kt)("p",{parentName:"li"},"\u4e0a\u9762\u5176\u5b9e\u5df2\u7ecf\u5728\u53c2\u6570\u68c0\u67e5\u7684\u65f6\u5019\u505a\u8fc7\u4e86, \u4e5f\u5c31\u662f\u8fd9\u6bb5\u4ee3\u7801"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n    return value\n}\nconst realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n    throw reason;\n};\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c onFulfilled \u6216\u8005 onRejected \u8fd4\u56de\u4e00\u4e2a\u503c x \uff0c\u5219\u8fd0\u884cresolvePromise\u65b9\u6cd5"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"then(onFulfilled, onRejected) {\n    const realOnFulfilled = this.isFunction(onFulfilled) ? onFulfilled : (value) => {\n        return value\n    }\n    const realOnRejected = this.isFunction(onRejected) ? onRejected : (reason) => {\n        throw reason;\n    };\n    const promise2 = new MPromise((resolve, reject) => {\n        const fulfilledMicrotask = () => {\n            try {\n                const x = realOnFulfilled(this.value);\n                this.resolvePromise(promise2, x, resolve, reject);\n            } catch (e) {\n                reject(e)\n            }\n        };\n        const rejectedMicrotask = () => {\n            try {\n                const x = realOnRejected(this.reason);\n                this.resolvePromise(promise2, x, resolve, reject);\n            } catch (e) {\n                reject(e);\n            }\n        }\n\n        switch (this.status) {\n            case FULFILLED: {\n                fulfilledMicrotask()\n                break;\n            }\n            case REJECTED: {\n                rejectedMicrotask()\n                break;\n            }\n            case PENDING: {\n                this.FULFILLED_CALLBACK_LIST.push(fulfilledMicrotask)\n                this.REJECTED_CALLBACK_LIST.push(rejectedMicrotask)\n            }\n        }\n    })\n    return promise2\n}\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"resolvePromise"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"resolvePromise(promise2, x, resolve, reject) {\n    // \u5982\u679c newPromise \u548c x \u6307\u5411\u540c\u4e00\u5bf9\u8c61\uff0c\u4ee5 TypeError \u4e3a\u636e\u56e0\u62d2\u7edd\u6267\u884c newPromise\n    // \u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u6b7b\u5faa\u73af\n    if (promise2 === x) {\n        return reject(new TypeError('The promise and the return value are the same'));\n    }\n\n    if (x instanceof MPromise) {\n        // \u5982\u679c x \u4e3a Promise \uff0c\u5219\u4f7f newPromise \u63a5\u53d7 x \u7684\u72b6\u6001\n        // \u4e5f\u5c31\u662f\u7ee7\u7eed\u6267\u884cx\uff0c\u5982\u679c\u6267\u884c\u7684\u65f6\u5019\u62ff\u5230\u4e00\u4e2ay\uff0c\u8fd8\u8981\u7ee7\u7eed\u89e3\u6790y\n        queueMicrotask(() => {\n            x.then((y) => {\n                this.resolvePromise(promise2, y, resolve, reject);\n            }, reject);\n        })\n    } else if (typeof x === 'object' || this.isFunction(x)) {\n        // \u5982\u679c x \u4e3a\u5bf9\u8c61\u6216\u8005\u51fd\u6570\n        if (x === null) {\n            // null\u4e5f\u4f1a\u88ab\u5224\u65ad\u4e3a\u5bf9\u8c61\n            return resolve(x);\n        }\n        \n        let then = null;\n\n        try {\n            // \u628a x.then \u8d4b\u503c\u7ed9 then \n            then = x.then;\n        } catch (error) {\n            // \u5982\u679c\u53d6 x.then \u7684\u503c\u65f6\u629b\u51fa\u9519\u8bef e \uff0c\u5219\u4ee5 e \u4e3a\u636e\u56e0\u62d2\u7edd promise\n            return reject(error);\n        }\n\n        // \u5982\u679c then \u662f\u51fd\u6570\n        if (this.isFunction(then)) {\n            let called = false;\n            // \u5c06 x \u4f5c\u4e3a\u51fd\u6570\u7684\u4f5c\u7528\u57df this \u8c03\u7528\n            // \u4f20\u9012\u4e24\u4e2a\u56de\u8c03\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u53eb\u505a resolvePromise \uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u53eb\u505a rejectPromise\n            try {\n                then.call(\n                    x,\n                    // \u5982\u679c resolvePromise \u4ee5\u503c y \u4e3a\u53c2\u6570\u88ab\u8c03\u7528\uff0c\u5219\u8fd0\u884c resolvePromise\n                    (y) => {\n                        // \u9700\u8981\u6709\u4e00\u4e2a\u53d8\u91cfcalled\u6765\u4fdd\u8bc1\u53ea\u8c03\u7528\u4e00\u6b21.\n                        if (called) return;\n                        called = true;\n                        this.resolvePromise(promise2, y, resolve, reject);\n                    },\n                    // \u5982\u679c rejectPromise \u4ee5\u636e\u56e0 r \u4e3a\u53c2\u6570\u88ab\u8c03\u7528\uff0c\u5219\u4ee5\u636e\u56e0 r \u62d2\u7edd promise\n                    (r) => {\n                        if (called) return;\n                        called = true;\n                        reject(r);\n                    });\n            } catch (error) {\n                // \u5982\u679c\u8c03\u7528 then \u65b9\u6cd5\u629b\u51fa\u4e86\u5f02\u5e38 e\uff1a\n                if (called) return;\n\n                // \u5426\u5219\u4ee5 e \u4e3a\u636e\u56e0\u62d2\u7edd promise\n                reject(error);\n            }\n        } else {\n            // \u5982\u679c then \u4e0d\u662f\u51fd\u6570\uff0c\u4ee5 x \u4e3a\u53c2\u6570\u6267\u884c promise\n            resolve(x);\n        }\n    } else {\n        // \u5982\u679c x \u4e0d\u4e3a\u5bf9\u8c61\u6216\u8005\u51fd\u6570\uff0c\u4ee5 x \u4e3a\u53c2\u6570\u6267\u884c promise\n        resolve(x);\n    }\n}\n")),(0,a.kt)("ol",{start:9},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"onFulfilled \u548c onRejected \u662f\u5fae\u4efb\u52a1"),(0,a.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u7528",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/queueMicrotask"},"queueMicrotask"),"\u5305\u88f9\u6267\u884c\u51fd\u6570"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fulfilledMicrotask = () => {\n    queueMicrotask(() => {\n        try {\n            const x = realOnFulfilled(this.value);\n            this.resolvePromise(promise2, x, resolve, reject);\n        } catch (e) {\n            reject(e)\n        }\n    })\n};\nconst rejectedMicrotask = () => {\n    queueMicrotask(() => {\n        try {\n            const x = realOnRejected(this.reason);\n            this.resolvePromise(promise2, x, resolve, reject);\n        } catch (e) {\n            reject(e);\n        }\n    })\n}\n")),(0,a.kt)("ol",{start:10},(0,a.kt)("li",{parentName:"ol"},"\u7b80\u5355\u6d4b\u8bd5\u4e00\u4e0b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const test = new MPromise((resolve, reject) => {\n    setTimeout(() => {\n        resolve(111);\n    }, 1000);\n}).then((res) => {\n    console.log(res)\n});\n\nconsole.log(test);\n\nsetTimeout(() => {\n    console.log(test);\n}, 2000)\n")),(0,a.kt)("ol",{start:11},(0,a.kt)("li",{parentName:"ol"},"catch\u65b9\u6cd5")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"catch (onRejected) {\n    return this.then(null, onRejected);\n}\n")),(0,a.kt)("ol",{start:12},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"promise.resolve"),(0,a.kt)("p",{parentName:"li"},"\u5c06\u73b0\u6709\u5bf9\u8c61\u8f6c\u4e3aPromise\u5bf9\u8c61\uff0c\u5982\u679c Promise.resolve \u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u4e0d\u662f\u5177\u6709 then \u65b9\u6cd5\u7684\u5bf9\u8c61\uff08\u53c8\u79f0 thenable \u5bf9\u8c61\uff09\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 Promise \u5bf9\u8c61\uff0c\u4e14\u5b83\u7684\u72b6\u6001\u4e3afulfilled\u3002\n\u6ce8\u610f\u8fd9\u662f\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5, \u56e0\u4e3a\u662f\u901a\u8fc7Promise.resolve\u8c03\u7528\u7684, \u800c\u4e0d\u662f\u901a\u8fc7\u5b9e\u4f8b\u53bb\u8c03\u7528\u7684."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"static resolve(value) {\n    if (value instanceof MPromise) {\n        return value;\n    }\n\n    return new MPromise((resolve) => {\n        resolve(value);\n    });\n}\n")),(0,a.kt)("ol",{start:13},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"promise.reject"),(0,a.kt)("p",{parentName:"li"},"\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684Promise\u5b9e\u4f8b\uff0c\u8be5\u5b9e\u4f8b\u7684\u72b6\u6001\u4e3arejected\u3002Promise.reject\u65b9\u6cd5\u7684\u53c2\u6570reason\uff0c\u4f1a\u88ab\u4f20\u9012\u7ed9\u5b9e\u4f8b\u7684\u56de\u8c03\u51fd\u6570\u3002"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"static reject(reason) {\n    return new MPromise((resolve, reject) => {\n        reject(reason);\n    });\n}\n")),(0,a.kt)("ol",{start:14},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"promise.race"),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"const p = Promise.race([p1, p2, p3]);")),(0,a.kt)("p",{parentName:"li"},"\u8be5\u65b9\u6cd5\u662f\u5c06\u591a\u4e2a Promise \u5b9e\u4f8b\uff0c\u5305\u88c5\u6210\u4e00\u4e2a\u65b0\u7684 Promise \u5b9e\u4f8b\u3002\n\u53ea\u8981p1\u3001p2\u3001p3\u4e4b\u4e2d\u6709\u4e00\u4e2a\u5b9e\u4f8b\u7387\u5148\u6539\u53d8\u72b6\u6001\uff0cp\u7684\u72b6\u6001\u5c31\u8ddf\u7740\u6539\u53d8\u3002\u90a3\u4e2a\u7387\u5148\u6539\u53d8\u7684 Promise \u5b9e\u4f8b\u7684\u8fd4\u56de\u503c\uff0c\u5c31\u4f20\u9012\u7ed9p\u7684\u56de\u8c03\u51fd\u6570\u3002"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"static race(promiseList) {\n    return new MPromise((resolve, reject) => {\n        const length = promiseList.length;\n\n        if (length === 0) {\n            return resolve();\n        } else {\n            for (let i = 0; i < length; i++) {\n                MPromise.resolve(promiseList[i]).then(\n                    (value) => {\n                        return resolve(value);\n                    },\n                    (reason) => {\n                        return reject(reason);\n                    });\n            }\n        }\n    });\n\n}\n")),(0,a.kt)("ol",{start:15},(0,a.kt)("li",{parentName:"ol"},"\u7b80\u5355\u6d4b\u8bd5\u4e00\u4e0b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const test1 = new MPromise((resolve, reject) => {\n    setTimeout(() => {\n        resolve(111);\n    }, 1000);\n});\n\nconst test2 = new MPromise((resolve, reject) => {\n    setTimeout(() => {\n        resolve(222);\n    }, 2000);\n});\n\nconst test3 = new MPromise((resolve, reject) => {\n    setTimeout(() => {\n        resolve(333);\n    }, 3000);\n});\n\nMPromise.race([test1, test2, test3]).then(console.log); // 111\n")))}m.isMDXComponent=!0}}]);